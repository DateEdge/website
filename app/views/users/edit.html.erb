<% if flash[:error] or flash[:notice] %>
  <div>
    <%= flash[:error] %>
    <%= flash[:notice] %>
  </div>
<% end %>

<% unless @user.twitter? && @user.facebook? %>
  <div class="buttons">
    <% if @user.twitter? %>
      <%= button_to_facebook_sign_in %>
    <% elsif @user.facebook? %>
      <%= button_to_twitter_sign_in %>
    <% end %>
  </div>

  <p class="note">
    Connecting both your Twitter and Facebook accounts makes it easier to fill out your Date Edge profile, which helps you find people.
  </p>

  <p class="note">
    And if Twitter or Facebook ever has downtime, you can use the other to sign in to Date Edge.
  </p>
<% end %>

<%= @user.errors.full_messages.to_sentence %>

<%= form_for @user, url: update_settings_path do |f| %>
  <%= f.label      :name %>
  <%= f.text_field :name, :autocapitalize => "words" %>

  <% if @user.username.blank? %>
    <%= f.label      :username %>
    <%= f.text_field :username, :autocapitalize => "off", :autocorrect => "off" %>
  <% end %>

  <%= f.label       :email %>
  <%= f.email_field :email, :autocapitalize => "off", :autocorrect => "off" %>

  <%= f.label :birthday %>
  <%= birthday_select_tag(f) %>

  <%= f.label      :city %>
  <%= f.text_field :city, :autocapitalize => "words" %>

  <%= f.label  :state %>
  <%= f.select :state_id, State.options_for_select, :include_blank => true %>

  <%= f.label      :zipcode %>
  <%= f.text_field :zipcode, :autocapitalize => "characters" %>

  <%= f.label  :country %>
  <%= f.select :country_id, Country.options_for_select, :include_blank => true %>

  <%= f.label     :bio %>
  <%= f.text_area :bio, :autocapitalize => "sentences" %>

  <%= f.label  :diet %>
  <%= f.select :diet_id, Diet.options_for_select, :include_blank => true %>

  <%= f.label      :me_gender,  "My Gender" %>
  <%= f.text_field :me_gender,  :autocapitalize => "words" %>

  <%= f.label      :you_gender, "Desired Gender" %>
  <%= f.text_field :you_gender, :autocapitalize => "words" %>

  <%= f.label :label_id, "My Straightedginess" %>
  <table id="my-label">
    <% Label.all.each do |label| %>
      <tr>
        <td><%= f.radio_button :label_id,              label.id, :checked => @user.label == label %></td>
        <th><%= f.label        "label_id_#{label.id}", label.name.titleize %></th>
      </tr>
    <% end %>
  </table>

  <%= f.label :your_labels_attributes, "Desired Straightedginess" %>
  <table id="desired-labels">
    <% Label.all.each_with_index do |label, index| %>
      <%= f.fields_for "your_labels_attributes[#{index}]", :child_index => index do |ff| %>
        <tr>
          <% if @user.desired_labels.include? label %>
            <%# TODO remove find from view, do it in the controller %>
            <%= ff.hidden_field :id, :value => @user.your_labels.where(:label_id => label.id).first.id, :style => "display:none" %>
            <td><%= ff.check_box :_destroy, { :checked => true }, 0, 1 %></td>
            <th><%= ff.label     :_destroy, label.name.titleize %></th>
          <% else %>
            <td><%= ff.check_box :label_id, {}, label.id %></td>
            <th><%= ff.label     :label_id, label.name.titleize %></th>
          <% end %>
        </th>
      <% end %>
    <% end %>
  </table>

  <%= f.submit "Save Changes", :disable_with => "Saving&hellip;".html_safe, :class => "button black full" %>
<% end %>



<div id="danger-zone">
  <h2>DANGER ZONE</h2>

  <div>
    <p>
      If you want to leave this place, that&rsquo;s your decision.
      We&rsquo;ll be sad to see you go, but we can respect that.
    </p>

    <p>
      All of your user profile and related data will be immediately deleted.
      No Twitter or Facebook information will be further stored.
    </p>

    <p>
      <b>There is no undo. No regrets.</b>
    </p>

    <%= button_to "I Want to Delete My Profile",
                  user_path(@user),
                  :method  => :delete,
                  :confirm => "Uhhhh&hellip; Are you sure you want to delete your profile?".html_safe,
                  :class   => "button red full" %>
  </div>
</div> <!-- #danger-zone -->
